---
title: "Occupational Data"
author: "Mary Hennigan and Rob Wells and Abby Zimmardi" 
date: "3/1/2021"
output: pdf_document
---

# Mary- Abby:
# Please go through and do some serious cutting on this script
# 
# 1) Move the whole occupational_master table construction to the end.
# Kill out any previous versions
# 2) Clean cities.
# 3) Clean counties.
# 4) Write an updated csv with the cleaned companies, cities and counties
# 5) Run totals by company, highest cases




# Compilation of Occupational COVID-19 Reports for Calculations

-**It will create a masterfile: occupational_master.csv**

# Part 1: Import Data, Clean It

```{r include=FALSE}
#install.packages("slider")
#install.packages("zoo")
#install.packages("gtools")
# vignette("basic-usage", package="googlesheets")
#install.packages("googledrive")
#install.packages("googlesheets4")
library(tidyverse)
library(janitor)
library(lubridate)
library(googlesheets4)
library(googledrive)
library(tidyr)
library(jsonlite)
library(gtools)
library(zoo)
library(reshape2)
library(slider)
```



#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#Part 1: CLEANING
#--------------------------------------------------------------------#
#--------------------------------------------------------------------#

#Import occupational_master from github. New version needs to be imported 

```{r}
occupational_master <- rio::import("https://raw.githubusercontent.com/profrobwells/Spring2021Data/main/occupational_master.csv")

```



#County Work
#Needs more cleaning: Some early records have two cities in city and two counties in county. Three December reports have part of the Industry type in the county column


#WELLS NOTE: Two of the wealthiest counties in Arkansas have the highest number of occupational reports Benton, 95; Washington 83;


```{r}
#Analyze records by county location
countyreports <- occupational_master %>% 
  select(date, city, county) %>% 
  group_by(county) %>% 
  count() %>% 
  arrange(desc(n))

countyreports

#apply the remove punctuation
occupational_master$county <- gsub("[[:space:]]", "", occupational_master$county)


#write.csv(countyreports, "countyreports.csv")

#Notes: Benton, 95; Washington 83; Pope 68;Craighead 56 are the top counties. This is not 100% cleaned yet, but nearly finished.
  
```


#City Work
#Needs more cleaning. "AR" is not a city. Two reports from May have two cities listed in one cell. Six reports from October have part of the Industry type split between City and County column. Ft Smith and Fort Smith need to be mutated, GreenForest and GreenForrest. "Various locations" is not a city. Springdale Public school is in Springdale City, Washington County. 
#Group reoccuring names - City

#USE THIS TEMPLATE TO CLEAN CITY NAMES
```{r}
#Thanks Sean, Kara and Nick:
cleaned_data <- occupational_master %>%
  mutate(cleaned = tolower(company_name)) %>%
  #mutate(cleaned = str_remove("'",cleaned)) %>%
  mutate(cleaned = case_when(
    str_detect(cleaned, "roehm") ~ "roehm_america",
    str_detect(cleaned, "tyson") ~ "tyson",
    TRUE ~ cleaned
  ))
```


#I don't think this is changing the names in the column to be regrouped? I don't understand
```{r}
fortsmith <- occupational_master %>% 
  filter(grepl ("Smith", city)) %>% 
  mutate(cleaned = "fort_smith")

greenforest <- occupational_master %>% 
  filter(grepl ("Green", city)) %>% 
  mutate(cleaned = "green_forest")

```

```{r}
#Analyze records by city location
cityreports <- occupational_master %>% 
  select(date, city, county) %>% 
  group_by(city) %>% 
  count() %>% 
  arrange(desc(n))
  
occupational_master$city <- gsub("[[:space:]]", "", occupational_master$city)

cityreports

#write.csv(cityreports, "cityreports.csv")

#Notes: Springdale has most reports with 70, Russellville follows with 59 then Rogers, 58. 
```



#Clean company names
```{r}
#Thanks Sean, Kara and Nick:
cleaned_data <- occupational_master %>%
  mutate(cleaned = tolower(company_name)) %>%
  #mutate(cleaned = str_remove("'",cleaned)) %>%
  mutate(cleaned = case_when(
    str_detect(cleaned, "roehm") ~ "roehm_america",
    str_detect(cleaned, "tyson") ~ "tyson",
    TRUE ~ cleaned
  ))
```

#Revised Look at the company names 
#add the function that produces percent of the whole
```{r}
cleaned_data %>% 
  count(cleaned) %>% 
  arrange(desc(n))
#TOTAL NUMBER OF ARK STATE HEATH DEPT REPORTS PER COMPANY SINCE MAY 19, 2020
#SIX OF TEN ARE POULTRY PROCESSING
#TYSON IS 36% OF ALL REPORTS
```

#NEXT: FILTER THIS TO THE SPECIFIC WORKPLACE AND THE HIGHEST VALUE OF CASES
#This yieled 11,472 total cases before cleaning of the city column
```{r}
companytotals <- cleaned_data %>% 
  select(company_name, cleaned, date, address, city, county, total_number_of_cases) %>% 
  group_by(cleaned, address, city,county) %>% 
  filter(total_number_of_cases == max(total_number_of_cases)) 

sum(companytotals$total_number_of_cases)
  
```



#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#Part 2: ANALYSIS
#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#TOTAL REPORTS BY CITY BY DAY
```{r}
#Analyze records by date and location

occupational_master %>% 
  select(date, company_name, city, county) %>% 
  group_by(date, city, county) %>% 
  count() %>% 
  arrange(desc(n))
  
```
#Continued Analysis
```{r}
#Analyze records by cleaned company name
companyreports <- occupational_master %>% 
  select(date, city, county, cleaned) %>% 
  group_by(cleaned) %>% 
  count() %>% 
  arrange(desc(n))
  
#write.csv(companyreports, "companyreports.csv")
companyreports

#Notes: Tyson, 250, ConAgra, 39, Simmons Foods, 39
```


```{r}
#Analyze records by industry
industryreports <- occupational_master %>% 
  select(date, city, county, company_name, industry) %>% 
  group_by(industry) %>% 
  count() %>% 
  arrange(desc(n))
#write.csv(industryreports, "industryreports.csv")
industryreports
  
#Notes: Largest industry category is NA with 459, from 5.19 to 9.14. These are when the reports were Poulty, Non-Poultry.
#Manufacturing has 326 records
```

#Split Dates for Analysis
```{r}
occupational_master$year <- year(occupational_master$date)
occupational_master$month <- month(occupational_master$date, label=TRUE)
#occupation_master1$week <- week(occupation_master1$date)
#occupation_master1$day <- day(occupation_master1$date)
#occupation_master1$weekday <- wday(occupation_master1$date, label=TRUE, abbr=FALSE)

occupational_master
```
#WELLS COMMENT: Let's do a ggplot graphic with this
#Group by Month
```{r}
month_counts <- occupational_master %>%
  select(date, city, county, company_name, industry, month) %>% 
  group_by(month) %>% 
  count() %>% 
  arrange(desc(n))
month_counts
write.csv(month_counts,"month_counts.csv")
#Notes: June, 147, July, 142, Dec, 110 and Aug, 109 are the top months and only months above 100.
```

#Zimmardi attempt at a ggplot graphic
```{r}
#install.packages("ggplot2")
library(ggplot2)
#ggplot(month_counts, aes(x=month, y=n))
ggplot(month_counts) + geom_point(aes(x=month, y=n, color=n)) + geom_smooth(aes(x=month, y=n, color=n))


#Zimmardi note: I have been looking up different codes, and I can't figure out how to change the label names and add a title. But this shows the number of records by month.
```







#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#Part 3: TABLE BUILDING
#--------------------------------------------------------------------#
#--------------------------------------------------------------------#


#THIS IS THE BUILDING PORTION. CAN SKIP TO LINE 363 FOR OCCUPATIONAL_MASTER IMPORT AND ANALYSIS
 
#We have two spreadsheets in Google that contain all occupational outbreak reports from May 19, 2020 - Feb. 22, 2021
#Occupationals from PDFs https://docs.google.com/spreadsheets/d/1R5dVT4QN586ANvAH1SJ7ye94Br5OtrZsAA2e4KlWn0o/edit#gid=1215399371 
#Leftovers https://docs.google.com/spreadsheets/d/1iuxIguTLVKhVBxAeIGg2enB5cmhDhTbOqWb6w7XHIzI/edit#gid=1206136585

#Start master file by pulling in individual sheets 
#23 reports from May 19 - August 7 

#Wells Question: So these are all of the new sheets you got from Gavin and put in, correct?



```{r include=FALSE}
occupation5_19 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 5.19")
occupation5_22 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 5.22")
occupation5_26 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 5.26")
occupation5_29 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 5.29")
occupation6_2 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.2") 
occupation6_5 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.5") 
occupation6_8 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.8") 
occupation6_14 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.14") 
occupation6_18 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.18") 
occupation6_21 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.21") 
occupation6_25 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 6.25")
occupation7_3 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.3")
occupation7_6 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.6")
occupation7_13 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.13")
occupation7_20 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.20")
occupation7_24 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.24")
occupation7_27 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.27")
occupation7_31 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 7.31")
occupation8_3 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.3")
occupation8_7 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.7")
occupation8_17 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.17")
occupation8_24 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.24")
occupation8_27 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.27")
occupation8_31 <- rio::import("Occupationals from PDFs.xlsx",which = "Occupational 8.31")

```

#Pull in the rest of August that didn't fit into the sheet Occupationals from PDFs. 
#3 reports from the Leftovers file from Aug. 10, 13, 20
```{r}
occupation8_10 <- rio::import("Leftovers.xlsx",which = "Occupational 8.10")
occupation8_13 <- rio::import("Leftovers.xlsx",which = "Occupational 8.13")
occupation8_20 <- rio::import("Leftovers.xlsx",which = "Occupational 8.20")
```

#Continue pulling reports from Occupationals from PDFs.
#46 reports from Sept. 3, 2020 - Feb. 22, 2021
```{r}
occupation9_3 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.3")
occupation9_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.7")
occupation9_9 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.9")
occupation9_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.14")
occupation9_17 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.17")
occupation9_24 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.24")
occupation9_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.28")
occupation10_1 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.1")
occupation10_5 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.5")
occupation10_8 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.8")
occupation10_12 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.12")
occupation10_15 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.15")
occupation10_19 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.19")
occupation10_22 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.22")
occupation10_26 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.26")
occupation10_29 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.29")
occupation11_2 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.02")
occupation11_5 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.05")
occupation11_9 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.09")
occupation11_12 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.12")
occupation11_16 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.16")
occupation11_19 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.19")
occupation11_23 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.23")
occupation11_26 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.26")
occupation11_30 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.30")
occupation12_3 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.3")
occupation12_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.7")
occupation12_10 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.10")
occupation12_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.14")
occupation12_17 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.17")
occupation12_21 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.21")
occupation12_24 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.24")
occupation12_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.28")
occupation12_31 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.31")
occupation1_4 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.04")
occupation1_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.07")
occupation1_11 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.11")
occupation1_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.14")
occupation1_18 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.18")
occupation1_21 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.21")
occupation1_25 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.25")
occupation1_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.28")
occupation2_1 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.01")
occupation2_4 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.04")
occupation2_8 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.08")
occupation2_11 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.11")
occupation2_22 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.22")
```


#Add new dates here. They will pull from the Leftovers file. 
```{r}
#EDIT X with new date
#occupationalX <- rio::import("Leftovers.xlsx",which = "Occupational X")
```

#Clean and Normalize All Names
```{r include=FALSE}
occupation5_19 <- clean_names(occupation5_19)
occupation5_22 <- clean_names(occupation5_22)
occupation5_26 <- clean_names(occupation5_26)
occupation5_29 <- clean_names(occupation5_29)
occupation6_2 <- clean_names(occupation6_2)
occupation6_5 <- clean_names(occupation6_5)
occupation6_8 <- clean_names(occupation6_8)
occupation6_14 <- clean_names(occupation6_14)
occupation6_18 <- clean_names(occupation6_18)
occupation6_21 <- clean_names(occupation6_21)
occupation6_25 <- clean_names(occupation6_25)
occupation7_3 <- clean_names(occupation7_3)
occupation7_6 <- clean_names(occupation7_6)
occupation7_13 <- clean_names(occupation7_13)
occupation7_20 <- clean_names(occupation7_20)
occupation7_24 <- clean_names(occupation7_24)
occupation7_27 <- clean_names(occupation7_27)
occupation7_31 <- clean_names(occupation7_31)
occupation8_3 <- clean_names(occupation8_3)
occupation8_7 <- clean_names(occupation8_7)
occupation8_10 <- clean_names(occupation8_10)
occupation8_13 <- clean_names(occupation8_13)
occupation8_17 <- clean_names(occupation8_17)
occupation8_24 <- clean_names(occupation8_24)
occupation8_27 <- clean_names(occupation8_27)
occupation8_31 <- clean_names(occupation8_31)
occupation9_3 <- clean_names(occupation9_3)
occupation9_7 <- clean_names(occupation9_7)
occupation9_9 <- clean_names(occupation9_9)
occupation9_14 <- clean_names(occupation9_14)
occupation9_17 <- clean_names(occupation9_17)
occupation9_24 <- clean_names(occupation9_24)
occupation9_28 <- clean_names(occupation9_28)
occupation10_1 <- clean_names(occupation10_1)
occupation10_5 <- clean_names(occupation10_5)
occupation10_8 <- clean_names(occupation10_8)
occupation10_12 <- clean_names(occupation10_12)
occupation10_15 <- clean_names(occupation10_15)
occupation10_19 <- clean_names(occupation10_19)
occupation10_22 <- clean_names(occupation10_22)
occupation10_26 <- clean_names(occupation10_26)
occupation10_29 <- clean_names(occupation10_29)
occupation11_2 <- clean_names(occupation11_2)
occupation11_5 <- clean_names(occupation11_5)
occupation11_9 <- clean_names(occupation11_9)
occupation11_12 <- clean_names(occupation11_12)
occupation11_16 <- clean_names(occupation11_16)
occupation11_19 <- clean_names(occupation11_19)
occupation11_23 <- clean_names(occupation11_23)
occupation11_26 <- clean_names(occupation11_26)
occupation11_30 <- clean_names(occupation11_30)
occupation12_3 <- clean_names(occupation12_3)
occupation12_7 <- clean_names(occupation12_7)
occupation12_10 <- clean_names(occupation12_10)
occupation12_14 <- clean_names(occupation12_14)
occupation12_17 <- clean_names(occupation12_17)
occupation12_21 <- clean_names(occupation12_21)
occupation12_24 <- clean_names(occupation12_24)
occupation12_28 <- clean_names(occupation12_28)
occupation12_31 <- clean_names(occupation12_31)
occupation1_4 <- clean_names(occupation1_4)
occupation1_7 <- clean_names(occupation1_7)
occupation1_11 <- clean_names(occupation1_11)
occupation1_14 <- clean_names(occupation1_14)
occupation1_18 <- clean_names(occupation1_18)
occupation1_21 <- clean_names(occupation1_21)
occupation1_25 <- clean_names(occupation1_25)
occupation1_28 <- clean_names(occupation1_28)
occupation2_1 <- clean_names(occupation2_1)
occupation2_4 <- clean_names(occupation2_4)
occupation2_8 <- clean_names(occupation2_8)
occupation2_11 <- clean_names(occupation2_11)
occupation2_22 <- clean_names(occupation2_22)

#add the most recent dates here
```

#Cleaning prior to Combination
#May 19 File renaming
```{r}
occupation5_19 <- occupation5_19 %>% 
  rename(company_name = "business_name",
         city = "location")
occupation5_19

```

#Rename files with column "employer, total_cases, number_closed_cases"
#May 22, 26
```{r}
occupation5_22 <- occupation5_22 %>% 
  rename(company_name = "employer",
         total_number_of_cases = "total_cases",
         number_recovered_cases = "number_closed_cases")
#occupation5_22

occupation5_26 <- occupation5_26 %>% 
  rename(company_name = "employer",
         total_number_of_cases = "total_cases",
         number_recovered_cases = "number_closed_cases")
#occupation5_26
```

#Rename files with employer_city_county column
#Dates May 29, 2020 - Sept. 14, 2020
```{r}
employer_column <- smartbind(occupation5_29,
                             occupation6_2,
                                 occupation6_5,
                                 occupation6_8,
                                 occupation6_14,
                                 occupation6_18,
                                 occupation6_21,
                                 occupation6_25,
                                 occupation7_3,
                                 occupation7_6,
                                 occupation7_13,
                                 occupation7_20,
                                 occupation7_24,
                                 occupation7_27,
                                 occupation7_31,
                                 occupation8_3,
                                 occupation8_7,
                                 occupation8_10,
                                 occupation8_13,
                                 occupation8_17,
                                 occupation8_24,
                                 occupation8_27,
                                 occupation8_31,
                                 occupation9_3,
                                 occupation9_7,
                                 occupation9_9,
                                 occupation9_14)


#Separate the fields to industry, city, county
employer_column <- separate(data = employer_column, col = employer_city_county, into = c("company_name", "city", "county"), sep = ",", extra = "merge", fill = "right")

glimpse(employer_column)
```



#Rename files with industry_city_county column
#Dates Sept. 17, 2020 - Present
```{r}
industry_column <- smartbind(occupation9_17,
                                 occupation9_24,
                                 occupation9_28,
                                 occupation10_1,
                                 occupation10_5,
                                 occupation10_8,
                                 occupation10_12,
                                 occupation10_15,
                                 occupation10_19,
                                 occupation10_22,
                                 occupation10_26,
                                 occupation10_29,
                                 occupation11_2,
                                 occupation11_5,
                                 occupation11_9,
                                 occupation11_12,
                                 occupation11_16,
                                 occupation11_19,
                                 occupation11_23,
                                 occupation11_26,
                                 occupation11_30,
                                 occupation12_3,
                                 occupation12_7,
                                 occupation12_10,
                                 occupation12_14,
                                 occupation12_17,
                                 occupation12_21,
                                 occupation12_24,
                                 occupation12_28,
                                 occupation12_31,
                                 occupation1_4,
                                 occupation1_7,
                                 occupation1_11,
                                 occupation1_14,
                                 occupation1_18,
                                 occupation1_21,
                                 occupation1_25,
                                 occupation1_28,
                                 occupation2_1,
                                 occupation2_4,
                                 occupation2_8,
                                 occupation2_11,
                                 occupation2_22)


#Separate the fields to industry, city, county
industry_column <- separate(data = industry_column, col = industry_city_county, into = c("industry", "city", "county"), sep = ",", extra = "merge", fill = "right")

glimpse(industry_column)
```

#Combine May 19, 2020 - Feb. 22, 2021
#Recreating occupational_master

#WELLS NOTE: Excellent. You answered my question.
#Next question: What did we lost by eliminating the poultry general rows?

#Has 814 observations. Our previous master had 1004. We have removed all of the poultry general rows.

#WELLS NOTE Collect the poultry in a separate dataframe
```{r warning=FALSE}
occupational_master <- smartbind(occupation5_19,
                                 occupation5_22,
                                 occupation5_26,
                                 employer_column,
                                 industry_column)
glimpse(occupational_master)

write.csv(occupational_master, "occupational_master.csv")

```



#Initial Look at the company names 
```{r}
#Company Name count shows Tyson has a huge presence with 250 appearances in the reports. 
#This Tyson count does NOT include Tyson Corporate, Tyson Mexican Original, Tyson of Rogers, Tyson's Chick-N-Quick and Tyson's Mexican Original. 
#Hennigan: Missing company name on 11-30 and most recent 2-22 report
occupational_master %>% 
  count(company_name) %>% 
  arrange(desc(n))
```

#Notes on Company Names
#Tyson needs to be further consolidated to encompass all entities (Tyson Corporate, Tyson Mexican Original, Tyson of Rogers, Tyson's Chick-N-Quick and Tyson's Mexican Original.)

#Other companies with slight differences are: ConAgra, George's/Ozark Mountain Poultry, Pilgrim's Pride, Riceland Foods, Roehm America, Saracen Construction ---These are listed as reoccurring company names at line 489. 

#Need to ensure these are the same entitiy: Simmons Foods and Simmons Poultry 


#Quick Check on Tyson and evolution
```{r}
tyson <- occupational_master %>% 
  select(date, company_name, city, county, total_number_of_cases) %>% 
  filter(company_name == "Tyson")
tyson

```

#WELLS NOTE: For example, we lost tyson_berry as a detail.


```{r}
tyson_berry <- filter(tyson, grepl ("Springdale", city))
tyson_berry
#write.csv(tyson_berry,"tyson_berry.csv")

```

#Note:
```{r}
#Use contains to search by string to find the variables by name
#this grabs everything except date
#berryst <- select(tyson_berry, contains("Berry"))
#names(berryst)
```


#Wells Note:
#Please list the companies with overlapping names that I need to extract
#For example, sort this DF below in alphabetical order (there's a sort function in the header when you bring the table up in R)
#You'll see three Butterball entries:
Butterball
Butterball Huntsville
Butterball Ozark
#Just write here: Butterball. Tyson. Simmons, George's etc. 
#We'll use that list to extract a new column with common names.
#See this tutorial, Part 4: Using Mutate
#https://profrobwells.github.io/HomelessSP2020/SF_311_Calls_UofA.html#part_2:_cleaning__analysis
#See Use grepl to search and tabulate
#Follow those steps to extract the company names and create a new column, company1, that contains the simplified version





#-----------------------------
#Hennigan Stopped here 
#Everything below needs to be adjusted to the new occupational_master file. 
#Zimmardi adjusted everything below to the new occupational_master file.
#---------------------------



#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#NOTES BELOW THIS LINE. OUTDATED SEQUENCE OF MATCHING NAMES TO RECORDS
#--------------------------------------------------------------------#
#--------------------------------------------------------------------#

#this old 
```{r}
industry_master %>% 
  select(date, city, county) %>% 
  group_by(date, city, county) %>% 
  count() %>% 
  arrange(desc(n))
#join all of the one values
#filter to 1 and join that to original df (master)

#clean industry master to get rid of entertainment
#Test on 12-17-2020 Jonesboro. five cases dont match with the five companies.
```
#Stop Here
#Background: Manual Import data from Hard Drive 
```{r}
#  occupation5_25 <- rio::import("/Users/maryhennigan/Downloads/OSHA Project 2021/OccupationMaster.xlsx", which = "525 Occupational")

#Wells 
  # occupation5_25 <- rio::import("/Users/rswells/Dropbox/Classes/Data Spring 2021/Facilities-Occupational Cases-Deaths.xlsx", which = "525 Occupational")

##import the file from your hard drive

# occupation10_1 <- rio::import("/Users/maryhennigan/Downloads/OSHA Project 2021/Occupationals from PDFs.xlsx", which = "Occupational 10.1")

```





#Import 329 records of company names and dates.
```{r}
#329 records
names <- rio::import("Facilities-Occupational Cases-Deaths.csv")
names$Date <- ymd(names$Date)
write.csv(names,"names.csv")
glimpse(names)
```
#Join the Industry and Names Files

#Howard Center People Start Here:
```{r}
#329 records from Sept 17 to Jan 28
names <- rio::import("https://raw.githubusercontent.com/profrobwells/Spring2021Data/main/names.csv")
#311 records from Sept 28 to Feb 1
industry_master <- rio::import("https://raw.githubusercontent.com/profrobwells/Spring2021Data/main/industry_master.csv")


#This is the first problem: ADH gave us more names than industry records. Check that Sept 17 doesn't have 18 record that would account for the difference.

```

#We now join the industry db with a list of company names and dates

```{r}
joined_industry_names <- industry_master %>% 
  inner_join(names, by=c("date"="Date", "city"="City", "county"="County"))

write.csv(joined_industry_names,"joined_indstry_names.csv")

#Now 375 records. 64 extra than the source industry file

#Problem: 369 records, 58 extra than the source industry file
#It is posting double entries on some dates
```

#Possible Fix: Have them all the same date period: Sept 28-Jan 28
```{r}
#318 records
names2 <- names %>% 
  filter(Date >= "2020-09-28")

#307 records
industry_master2 <- industry_master %>% 
  filter(date >= ("2020-09-28")) %>% 
  filter(date <= ("2021-01-28"))
```
#What's messed up about this is the ADH gave us records for 11 more cases than what they reported.
#We should check to see if we have all the records by date for the names and industry master - see if there are some date or record gaps in industry master

#Anyway, we join again
```{r}
joined2 <- industry_master2 %>% 
  inner_join(names2, by=c("date"="Date", "city"="City", "county"="County"))


#Problem: Still 375 records, now 68 extra than the source industry file
#It is still posting double entries on some dates
```

#End of dilemma#


```{r}
nomatches <- industry_date %>% 
  anti_join(names_date, by=c("date"="Date", "n"="n"))
nomatches
#Oct 10, 5 records not in the Names file
#Nov 16 11 in names but 10 in industry
#Jan 18 14 in names but 15 in industry
#Feb 1 4 records not in Names file

```


#Notes Below#


#This section is aimed at running down the duplication

#73 records in the names file
```{r}
names_original <- names %>% 
  count(`Business Name`)
```

#68 records in the joined file
```{r}
joined_db <- joined %>% 
  count(`Business Name`)
```



```{r}
#problem: 403 records
joined2 <- industry_master %>% 
  left_join(names, by=c("date"="Date", "city"="City", "county"="County"))

```


###Format Dates
```{r}
library(lubridate)

names$year <- year(names$Date)
names$month <- month(names$Date, label=TRUE)
names$week <- week(names$Date)
names$day <- day(names$Date)
names$weekday <- wday(names$Date, label=TRUE, abbr=FALSE)


employer_master$year <- year(employer_master$date)
employer_master$month <- month(employer_master$date, label=TRUE)
employer_master$week <- week(employer_master$date)
employer_master$day <- day(employer_master$date)
employer_master$weekday <- wday(employer_master$date, label=TRUE, abbr=FALSE)



industry_master$year <- year(industry_master$date)
industry_master$month <- month(industry_master$date, label=TRUE)
industry_master$week <- week(industry_master$date)
industry_master$day <- day(industry_master$date)
industry_master$weekday <- wday(industry_master$date, label=TRUE, abbr=FALSE)
glimpse(industry_master)
```

```{r}
#Mini table
mini <- employer_master %>% 
  select(employer_city_county, date, year, month, week, day, weekday,total_number_of_cases)
mini
```




```{r}
sep <- employer_master %>% 
  select("employer_city_county", "date", "month", "total_number_of_cases") %>% 
filter(month == "Sep") %>% 
  arrange(desc("total_number_of_cases"))

sep


```


#fix this

```{r}
#Mini table
mini_industry <- industry_master %>% 
  select(industry_city_county, date, year, month, week, day, weekday,total_number_of_cases)
mini_industry
```

```{r}
oct <- industry_master %>% 
  select("industry_city_county", "date", "month", "total_number_of_cases") %>% 
filter(month == "Oct") %>% 
  arrange(desc("date"))

oct
write.csv(oct, "oct_industry.csv")

```




#------Under this is Old Building with Misty file, poultry, non-poultry, etc. No longer needed as of Feb. 26, 2021

#OLD
#This section for building the table from individual sheets
```{r include=FALSE}
#Import 19 Sheets, from May 25-Aug 20, 2020
occupation5_25 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "525 Occupational")
occupation5_29 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "529 Occupational")
occupation6_2 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "62 Occupational")
occupation6_5 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "65 Occupational")
occupation6_9 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "69 Occupational")
occupation6_12 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "612 Occupational")
occupation6_14 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "614 Occupational")
occupation6_18 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "618 Occupational")
occupation6_25 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "625 Occupational")
occupation6_28 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "628 Occupational")
occupation7_3 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "73 Occupational")
occupation7_6 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "76 Occupational")
occupation7_14 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "714 Occupational")
occupation7_21 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "721 Occupational")
occupation7_24 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "724 Occupational")
occupation8_3 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "83 Occupational")
occupation8_7 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "87 Occupational")
occupation8_10 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "810 Occupational")
occupation8_20 <- rio::import("Facilities-Occupational Cases-Deaths.xlsx", which = "820 Occupational")

#Assign dates
occupation5_25$date <- "2020-5-25"
occupation5_29$date <- "2020-5-29"
occupation6_2$date <- "2020-6-2"
occupation6_5$date <- "2020-6-05"
occupation6_9$date <- "2020-6-09"
occupation6_12$date <- "2020-6-12"
occupation6_14$date <- "2020-6-14"
occupation6_18$date <- "2020-6-18"
occupation6_25$date <- "2020-6-25"
occupation6_28$date <- "2020-6-28"
occupation7_3$date <- "2020-7-03"
occupation7_6$date <- "2020-7-06"
occupation7_14$date <- "2020-7-14"
occupation7_21$date <- "2020-7-21"
occupation7_24$date <- "2020-7-24"
occupation8_3$date <- "2020-8-03"
occupation8_7$date <- "2020-8-07"
occupation8_10$date <- "2020-8-10"
occupation8_20$date <- "2020-8-20"
```


#OLD
```{r warning=FALSE}
#Wells Note: 19 sheets, May 25-Aug 20
#Changed name to occupation_may_august to better keep track
#This is the Misty file

occupation_may_august <- smartbind(occupation5_25, occupation5_29, occupation6_2, occupation6_5,  occupation6_9, occupation6_12, occupation6_14, occupation6_18, occupation6_25, occupation6_28, occupation7_3, occupation7_6, occupation7_14, occupation7_21, occupation7_24,occupation8_3, occupation8_7,  occupation8_10, occupation8_20)


occupation_may_august <- clean_names(occupation_may_august)

#This combines 19 occupational data sheets from May 25 through Aug 20
write.csv(occupation_may_august, "occupationalmay_august.csv")

#Wells Note: Check this data against originals. No positives reported prior to June 5
#Hennigan Note: I did not ask for original data before August. We should to check Misty's entries and collect any missing data. 
```


#OLD
#The second spreadsheet has the data from September to February 2021
# https://docs.google.com/spreadsheets/d/1R5dVT4QN586ANvAH1SJ7ye94Br5OtrZsAA2e4KlWn0o/edit#gid=100802501
#This section for building the table from individual sheets
```{r include=FALSE}
occupation8_17 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 8.17")
occupation8_24 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 8.24")
occupation8_27 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 8.27")
occupation8_31 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 8.31")
occupation9_3 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.3")
occupation9_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.7")
occupation9_9 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.9")
occupation9_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.14")
occupation9_17 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.17")
occupation9_24 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.24")
occupation9_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 9.28")
occupation10_1 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.1")
occupation10_5 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.5")
occupation10_8 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.8")
occupation10_12 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.12")
occupation10_15 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.15")
occupation10_19 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.19")
occupation10_22 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.22")
occupation10_26 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.26")
occupation10_29 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 10.29")
occupation11_2 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.02")
occupation11_5 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.05")
occupation11_9 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.09")
occupation11_12 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.12")
occupation11_16 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.16")
occupation11_19 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.19")
occupation11_23 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.23")
occupation11_26 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.26")
occupation11_30 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 11.30")
occupation12_3 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.3")
occupation12_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.7")
occupation12_10 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.10")
occupation12_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.14")
occupation12_17 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.17")
occupation12_21 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.21")
occupation12_24 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.24")
occupation12_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.28")
occupation12_31 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 12.31")
occupation1_4 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.04")
occupation1_7 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.07")
occupation1_11 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.11")
occupation1_14 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.14")
occupation1_18 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.18")
occupation1_21 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.21")
occupation1_25 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.25")
occupation1_28 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 1.28")
occupation2_1 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.01")
occupation2_4 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.04")
occupation2_8 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.08")
occupation2_11 <- rio::import("Occupationals from PDFs.xlsx", which = "Occupational 2.11")
#Add new dates here
```

#OLD
#Clean and Normalize Names
```{r include=FALSE}
occupation8_17 <- clean_names(occupation8_17)
occupation8_24 <- clean_names(occupation8_24)
occupation8_27 <- clean_names(occupation8_27)
occupation8_31 <- clean_names(occupation8_31)
occupation9_3 <- clean_names(occupation9_3)
occupation9_7 <- clean_names(occupation9_7)
occupation9_9 <- clean_names(occupation9_9)
occupation9_14 <- clean_names(occupation9_14)
occupation9_17 <- clean_names(occupation9_17)
occupation9_24 <- clean_names(occupation9_24)
occupation9_28 <- clean_names(occupation9_28)
occupation10_1 <- clean_names(occupation10_1)
occupation10_5 <- clean_names(occupation10_5)
occupation10_8 <- clean_names(occupation10_8)
occupation10_12 <- clean_names(occupation10_12)
occupation10_15 <- clean_names(occupation10_15)
occupation10_19 <- clean_names(occupation10_19)
occupation10_22 <- clean_names(occupation10_22)
occupation10_26 <- clean_names(occupation10_26)
occupation10_29 <- clean_names(occupation10_29)
occupation11_2 <- clean_names(occupation11_2)
occupation11_5 <- clean_names(occupation11_5)
occupation11_9 <- clean_names(occupation11_9)
occupation11_12 <- clean_names(occupation11_12)
occupation11_16 <- clean_names(occupation11_16)
occupation11_19 <- clean_names(occupation11_19)
occupation11_23 <- clean_names(occupation11_23)
occupation11_26 <- clean_names(occupation11_26)
occupation11_30 <- clean_names(occupation11_30)
occupation12_3 <- clean_names(occupation12_3)
occupation12_7 <- clean_names(occupation12_7)
occupation12_10 <- clean_names(occupation12_10)
occupation12_14 <- clean_names(occupation12_14)
occupation12_17 <- clean_names(occupation12_17)
occupation12_21 <- clean_names(occupation12_21)
occupation12_24 <- clean_names(occupation12_24)
occupation12_28 <- clean_names(occupation12_28)
occupation12_31 <- clean_names(occupation12_31)
occupation1_4 <- clean_names(occupation1_4)
occupation1_7 <- clean_names(occupation1_7)
occupation1_11 <- clean_names(occupation1_11)
occupation1_14 <- clean_names(occupation1_14)
occupation1_18 <- clean_names(occupation1_18)
occupation1_21 <- clean_names(occupation1_21)
occupation1_25 <- clean_names(occupation1_25)
occupation1_28 <- clean_names(occupation1_28)
occupation2_1 <- clean_names(occupation2_1)
occupation2_4 <- clean_names(occupation2_4)
occupation2_8 <- clean_names(occupation2_8)
occupation2_11 <- clean_names(occupation2_11)

#add the most recent dates here
```

#OLD
#Combine through 9-14
#This creates an employer db from Aug 17-Sept 14
```{r warning=FALSE}
#Poultry and nonpoultry combined
#Poultry - nonpoultry ends on Sept 14
employer_masterAugSept <- smartbind(occupation8_17, occupation8_24, occupation8_27, occupation8_31, occupation9_3, occupation9_7, occupation9_9, occupation9_14)

employer_masterAugSept <- clean_names(employer_masterAugSept)
#dates
employer_masterAugSept$date <- ymd(employer_masterAugSept$date)

#Separate the fields to industry, city, county
employer_masterAugSept <- separate(data = employer_masterAugSept, col = employer_city_county, into = c("company_name", "city", "county"), sep = ",", extra = "merge", fill = "right")

#write.csv(employer_masterAugSept,"employer_masterAugSept.csv")


```

#OLD
#This creates an industry db from Sept 28-Feb 11, 2021. 
```{r warning=FALSE}
#This creates an industry db from Sept 28-Feb 1, 2021. It lacks the Employer Names
#Redo and sort in order later
industry_master <- smartbind(occupation2_11, 
                             occupation2_8, 
                             occupation2_4, 
                             occupation2_1, 
                             occupation1_28, 
                             occupation1_25, 
                             occupation1_21, 
                             occupation1_18, 
                             occupation1_14,
                             occupation1_11, 
                             occupation1_7, 
                             occupation1_4, 
                             occupation12_31, 
                             occupation12_28, 
                             occupation12_24, 
                             occupation12_21, 
                             occupation12_17, 
                             occupation12_14,
                             occupation12_10, 
                             occupation12_7, 
                             occupation12_3,
                             occupation11_30, 
                             occupation11_26, 
                             occupation11_23, 
                             occupation11_19, 
                             occupation11_16, 
                             occupation11_12, 
                             occupation11_9, 
                             occupation11_5, 
                             occupation11_2, 
                             occupation10_29, 
                             occupation10_26, 
                             occupation10_22,
                             occupation10_19, 
                             occupation10_15, 
                             occupation10_12, 
                             occupation10_8, 
                             occupation10_5, 
                             occupation10_1, 
                             occupation9_28, 
                             occupation9_24,
                             occupation9_17)

#occupation_master2 <- occupation_master2[ -c(3,4,5,6) ]

#arrange(occupation_master2,desc(Date))
industry_master$date <- ymd(industry_master$date)   


glimpse(industry_master)

```

#OLD
#separate the company and city by comma
```{r}

#Separate the fields to industry, city, county
industry_master <- separate(data = industry_master, col = industry_city_county, into = c("industry", "city", "county"), sep = ",", extra = "merge", fill = "right")

industry_master <- clean_names(industry_master)


industry_master$city <- str_trim(industry_master$city, side = c("both"))
industry_master$county <- str_trim(industry_master$county,  side = c("both"))
write.csv(industry_master,"industry_master.csv")
glimpse(industry_master)
```

#Combine the industry_master, employer_masterAugSept, occupation_may_august into a single new data frame. You'll need to fix the business to company_name in occupation_may_august. See if there are other fixes. Drop the Misty calculations - we will do our own. Make note of what Misty was calculating.

#Rename Misty File Columns to match
```{r}
occupation_may_august <- occupation_may_august %>% 
  rename(company_name = business, number_active_cases = active, number_recovered_cases = closed, total_number_of_cases = total_positivies)
occupation_may_august

#Hennigan Note: text in number fields "less than 5" should be changed, but I'm not sure what to. "Unknown" should become NA?
```

#OLD
#Join Tables
```{r}
occupation_master1 <- smartbind(occupation_may_august, employer_masterAugSept, industry_master) %>% 
arrange(desc(date)) 

occupation_master1 <- occupation_master1 %>% 
  select(date, company_name, address, city, county, number_active_cases, number_recovered_cases, industry, total_business, new_total, total_new, total_number_of_cases, percent_closed, x12, latitude, longitude)
  
glimpse(occupation_master1)
write.csv(occupation_master1, "occupation_master1.csv")

```

#OLD
#Group Reoccuring Names - County 
```{r}
arkansasco <- occupation_master1 %>% 
  filter(grepl ("Arkansas", county)) %>% 
  mutate(cleaned = "arkansas")

benton <- occupation_master1 %>% 
  filter(grepl ("Benton", county)) %>% 
  mutate(cleaned = "benton")

carroll <- occupation_master1 %>% 
  filter(grepl ("Carroll", county)) %>% 
  mutate(cleaned = "carroll")

cleveland <- occupation_master1 %>% 
  filter(grepl ("Cleveland", county)) %>% 
  mutate(cleaned = "cleveland")

craighead <- occupation_master1 %>% 
  filter(grepl ("Craighead", county)) %>% 
  mutate(cleaned = "craighead")

crawford <- occupation_master1 %>% 
  filter(grepl ("Crawford", county)) %>% 
  mutate(cleaned = "crawford")

garland <- occupation_master1 %>% 
  filter(grepl ("Garland", county)) %>% 
  mutate(cleaned = "garland")

independence <- occupation_master1 %>% 
  filter(grepl ("Independence", county)) %>% 
  mutate(cleaned = "independence")

jefferson <- occupation_master1 %>% 
  filter(grepl ("Jefferson", county)) %>% 
  mutate(cleaned = "jefferson")

mississippi <- occupation_master1 %>% 
  filter(grepl ("Mississippi", county)) %>% 
  mutate(cleaned = "mississippi")

pope <- occupation_master1 %>% 
  filter(grepl ("Pope", county)) %>% 
  mutate(cleaned = "pope")

randolph <- occupation_master1 %>% 
  filter(grepl ("Randolph", county)) %>% 
  mutate(cleaned = "randolph")

sebastian <- occupation_master1 %>% 
  filter(grepl ("Sebastian", county)) %>% 
  mutate(cleaned = "sebastian")

vanburenco <- occupation_master1 %>% 
  filter(grepl ("Van Buren", county)) %>% 
  mutate(cleaned = "van_buren")

washington <- occupation_master1 %>% 
  filter(grepl ("Washington", county)) %>% 
  mutate(cleaned = "washington")

```


#### Previous company name cleaning



#Example:
x915 <- SF %>% 
  filter(grepl ("915", original_crime_type_name)) %>% 
  mutate(cleaned = "homeless_complaint")
  
  
#Group Reoccuring Names - Company Names
#I don't think this is changing the names in the column to be regrouped? I don't understand

#WELLS NOTE: 
#This process below creates separate DFs with a new cleaned variable and the company original.
#The DFs then would be recombined into a new one 


```{r}
tyson <- occupational_master %>% 
  filter(grepl ("Tyson", company_name)) %>% 
  mutate(cleaned = "tyson")

conagra <- occupational_master %>% 
  filter(grepl ("ConAgra", company_name)) %>% 
  mutate(cleaned = "conagra")

georges <- occupational_master %>% 
  filter(grepl ("George's", company_name)) %>% 
  mutate(cleaned = "georges")

pilgrims <- occupational_master %>% 
  filter(grepl ("Pilgrim's", company_name)) %>% 
  mutate(cleaned = "pilgrims")

simmons <- occupational_master %>% 
  filter(grepl ("Simmons", company_name)) %>% 
  mutate(cleaned = "simmons")

riceland <- occupational_master %>% 
  filter(grepl ("Riceland", company_name)) %>% 
  mutate(cleaned = "riceland")

roehm <- occupational_master %>% 
  filter(grepl ("Roehm", company_name)) %>% 
  mutate(cleaned = "roehm_america")

saracen <- occupational_master %>% 
  filter(grepl ("Saracen", company_name)) %>% 
  mutate(cleaned = "saracen")



```

#CLEANED IS 402 records
```{r warning=FALSE}
occupational_cleaned <- smartbind(tyson, conagra, georges, pilgrims, simmons, 
                                  riceland, roehm, saracen)
glimpse(occupational_cleaned)

#write.csv(occupational_cleaned, "occupational_cleaned.csv")

```

#Extracts the records that were not cleaned: 

```{r}
notcleaned <- occupational_master %>% 
  anti_join(occupational_cleaned, by=("company_name"))
```


```{r}
notcleaned$cleaned <- notcleaned$company_name
glimpse(notcleaned)
```
```{r}
occupational_final <- smartbind(notcleaned, occupational_cleaned)
glimpse(occupational_final)
write.csv(occupational_final,"occupational_final.csv")
```

