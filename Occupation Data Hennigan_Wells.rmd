---
title: "Occupational Data"
author: "Mary Hennigan and Rob Wells and Abby Zimmardi" 
date: "3/1/2021"
output: pdf_document
---

# Mary- Abby:
# Please go through and do some serious cutting on this script

# 1) Moved the whole occupational_master table construction to the end.
# Kill out any previous versions
# 2) Clean cities.
# 3) Clean counties.
# 4) Clean companies
# 5) Write an updated csv with the cleaned companies, cities and counties
# 6) Run totals by company, highest cases



-**It will create a masterfile: occupational_master.csv**

# Part 1: Import Data, Clean It

```{r include=FALSE}
#install.packages("slider")
#install.packages("zoo")
#install.packages("gtools")
# vignette("basic-usage", package="googlesheets")
#install.packages("googledrive")
#install.packages("googlesheets4")
library(tidyverse)
library(janitor)
library(lubridate)
library(googlesheets4)
library(googledrive)
library(tidyr)
library(jsonlite)
library(gtools)
library(zoo)
library(reshape2)
library(slider)
```



#--------------------------------------------------------------------#
#--------------------------------------------------------------------#
#Part 1: CLEANING
#--------------------------------------------------------------------#
#--------------------------------------------------------------------#

```

#Cleaning prior to Combination
#May 19 File renaming
```{r}
occupation5_19 <- occupation5_19 %>% 
  rename(company_name = "business_name",
         city = "location")
occupation5_19

cleaned_data$cleaned_city <- str_trim(cleaned_data$cleaned_city)
#cleaned_data$cleaned_city <- gsub("[[:space:]]", "", occupational_master$cleaned_city)

#Rename files with industry_city_county column
#Dates Sept. 17, 2020 - Present
```{r}
industry_column <- smartbind(occupation9_17,
                                 occupation9_24,
                                 occupation9_28,
                                 occupation10_1,
                                 occupation10_5,
                                 occupation10_8,
                                 occupation10_12,
                                 occupation10_15,
                                 occupation10_19,
                                 occupation10_22,
                                 occupation10_26,
                                 occupation10_29,
                                 occupation11_2,
                                 occupation11_5,
                                 occupation11_9,
                                 occupation11_12,
                                 occupation11_16,
                                 occupation11_19,
                                 occupation11_23,
                                 occupation11_26,
                                 occupation11_30,
                                 occupation12_3,
                                 occupation12_7,
                                 occupation12_10,
                                 occupation12_14,
                                 occupation12_17,
                                 occupation12_21,
                                 occupation12_24,
                                 occupation12_28,
                                 occupation12_31,
                                 occupation1_4,
                                 occupation1_7,
                                 occupation1_11,
                                 occupation1_14,
                                 occupation1_18,
                                 occupation1_21,
                                 occupation1_25,
                                 occupation1_28,
                                 occupation2_1,
                                 occupation2_4,
                                 occupation2_8,
                                 occupation2_11,
                                 occupation2_22)


#Separate the fields to industry, city, county
industry_column <- separate(data = industry_column, col = industry_city_county, into = c("industry", "city", "county"), sep = ",", extra = "merge", fill = "right")

glimpse(industry_column)
```




#--------------------------------------------------------------------#
#--------------------------------------------------------------------#

#End of dilemma#


#apply the remove punctuation
occupational_master$county <- gsub("[[:space:]]", "", occupational_master$county)

#Notes Below#
```

#Combine the industry_master, employer_masterAugSept, occupation_may_august into a single new data frame. You'll need to fix the business to company_name in occupation_may_august. See if there are other fixes. Drop the Misty calculations - we will do our own. Make note of what Misty was calculating.

#Rename Misty File Columns to match
```{r}
occupation_may_august <- occupation_may_august %>% 
  rename(company_name = business, number_active_cases = active, number_recovered_cases = closed, total_number_of_cases = total_positivies)
occupation_may_august

#Hennigan Note: text in number fields "less than 5" should be changed, but I'm not sure what to. "Unknown" should become NA?
```

#OLD
#Join Tables
```{r}
occupation_master1 <- smartbind(occupation_may_august, employer_masterAugSept, industry_master) %>% 
arrange(desc(date)) 

occupation_master1 <- occupation_master1 %>% 
  select(date, company_name, address, city, county, number_active_cases, number_recovered_cases, industry, total_business, new_total, total_new, total_number_of_cases, percent_closed, x12, latitude, longitude)
  
glimpse(occupation_master1)
write.csv(occupation_master1, "occupation_master1.csv")

```

conagra <- occupational_master %>% 
  filter(grepl ("ConAgra", company_name)) %>% 
  mutate(cleaned = "conagra")
pilgrims <- occupational_master %>% 
  filter(grepl ("Pilgrim's", company_name)) %>% 
  mutate(cleaned = "pilgrims")

```

#Combine May 19, 2020 - Feb. 22, 2021
#Recreating occupational_master

```

